{
  "swagger": "2.0",
  "info": {
    "title": "K-Line API",
    "description": "K线数据相关接口，包括同步、查询及统计功能",
    "version": "1.0.0"
  },
  "schemes": ["http", "https"],
  "consumes": ["application/json"],
  "produces": ["application/json"],
  "paths": {
    "/klines/sync": {
      "post": {
        "tags": ["K线数据"],
        "summary": "同步K线数据",
        "description": "从外部API获取K线数据并同步到数据库。如果数据已存在则更新，不存在则新增。",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/SyncKlineRequest"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "同步成功",
            "schema": {
              "allOf": [
                { "$ref": "#/definitions/ApiResponse" },
                {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "synced": { "type": "integer", "description": "同步的数据条数" },
                        "total": { "type": "integer", "description": "总数据条数" }
                      }
                    }
                  }
                }
              ]
            }
          }
        }
      }
    },
    "/klines/list": {
      "post": {
        "tags": ["K线数据"],
        "summary": "查询K线数据列表",
        "description": "从数据库中查询指定股票的K线数据列表，支持筛选和分页。",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/QueryKlineRequest"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "查询成功",
            "schema": {
              "allOf": [
                { "$ref": "#/definitions/ApiResponse" },
                {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "array",
                          "items": { "$ref": "#/definitions/Kline" }
                        },
                        "total": { "type": "integer", "description": "总记录数" },
                        "page": { "type": "integer", "description": "当前页码" },
                        "limit": { "type": "integer", "description": "每页限制" }
                      }
                    }
                  }
                }
              ]
            }
          }
        }
      }
    },
    "/klines/stats": {
      "post": {
        "tags": ["K线数据"],
        "summary": "获取K线统计信息",
        "description": "获取指定股票在特定周期下的K线统计信息（如：总数、日期范围、均价等）。",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "required": ["code"],
              "properties": {
                "code": { "type": "string", "description": "股票代码" },
                "period": { "type": "integer", "description": "K线周期 (默认101)" }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取成功",
            "schema": {
              "allOf": [
                { "$ref": "#/definitions/ApiResponse" },
                {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "count": { "type": "string", "description": "总记录数" },
                        "minDate": { "type": "string", "description": "最早日期" },
                        "maxDate": { "type": "string", "description": "最晚日期" },
                        "avgClose": { "type": "string", "description": "平均收盘价" },
                        "maxHigh": { "type": "string", "description": "历史最高价" },
                        "minLow": { "type": "string", "description": "历史最低价" },
                        "avgVolume": { "type": "string", "description": "平均成交量" },
                        "totalAmount": { "type": "string", "description": "总成交额" }
                      }
                    }
                  }
                }
              ]
            }
          }
        }
      }
    }
  },
  "definitions": {
    "ApiResponse": {
      "type": "object",
      "properties": {
        "success": { "type": "boolean", "description": "是否成功" },
        "result": { "type": "integer", "description": "结果代码 (100为成功)" },
        "message": { "type": "string", "description": "提示信息" },
        "data": { "type": "object", "description": "返回的数据" }
      }
    },
    "SyncKlineRequest": {
      "type": "object",
      "required": ["code"],
      "properties": {
        "code": { "type": "string", "description": "股票代码 (如: 600519)" },
        "period": {
          "type": "string",
          "enum": ["daily", "weekly", "monthly", "1min", "5min", "15min", "30min", "60min"],
          "description": "K线周期"
        },
        "fqType": {
          "type": "integer",
          "enum": [0, 1, 2],
          "description": "复权类型 (0=不复权, 1=前复权, 2=后复权)"
        },
        "limit": { "type": "integer", "description": "获取数据条数限制" },
        "startDate": { "type": "string", "description": "开始日期 (YYYYMMDD)" },
        "endDate": { "type": "string", "description": "结束日期 (YYYYMMDD)" }
      }
    },
    "QueryKlineRequest": {
      "type": "object",
      "required": ["code"],
      "properties": {
        "code": { "type": "string", "description": "股票代码" },
        "period": {
          "type": "integer",
          "description": "K线周期 (101=日线, 102=周线, 103=月线, 1/5/15/30/60=分钟线)"
        },
        "startDate": { "type": "string", "description": "开始日期 (YYYY-MM-DD)" },
        "endDate": { "type": "string", "description": "结束日期 (YYYY-MM-DD)" },
        "page": { "type": "integer", "description": "页码", "default": 1 },
        "limit": { "type": "integer", "description": "每页记录数", "default": 100 },
        "orderBy": {
          "type": "string",
          "enum": ["ASC", "DESC"],
          "description": "排序方式 (按日期)",
          "default": "DESC"
        }
      }
    },
    "Kline": {
      "type": "object",
      "properties": {
        "id": { "type": "integer" },
        "code": { "type": "string", "description": "股票代码" },
        "name": { "type": "string", "description": "股票名称" },
        "period": { "type": "integer", "description": "周期代码" },
        "date": { "type": "string", "description": "日期/时间" },
        "open": { "type": "number", "description": "开盘价" },
        "close": { "type": "number", "description": "收盘价" },
        "high": { "type": "number", "description": "最高价" },
        "low": { "type": "number", "description": "最低价" },
        "volume": { "type": "integer", "description": "成交量" },
        "amount": { "type": "number", "description": "成交额" },
        "amplitude": { "type": "number", "description": "振幅(%)" },
        "pct": { "type": "number", "description": "涨跌幅(%)" },
        "change": { "type": "number", "description": "涨跌额" },
        "turnover": { "type": "number", "description": "换手率(%)" },
        "fqType": { "type": "integer", "description": "复权类型" },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      }
    }
  }
}
