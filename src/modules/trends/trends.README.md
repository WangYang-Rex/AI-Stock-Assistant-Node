# Trends æ¨¡å—æ–‡æ¡£

## æ¨¡å—æ¦‚è¿°

Trends æ¨¡å—è´Ÿè´£ç®¡ç†è‚¡ç¥¨åˆ†æ—¶æ•°æ®ï¼ŒåŒ…æ‹¬ä»ä¸œæ–¹è´¢å¯ŒSDKåŒæ­¥åˆ†æ—¶æ•°æ®ã€æŸ¥è¯¢åˆ†æ—¶æ•°æ®ã€åˆ é™¤åˆ†æ—¶æ•°æ®ä»¥åŠè‡ªåŠ¨æ¸…ç†å†å²æ•°æ®ç­‰åŠŸèƒ½ã€‚

## å®ä½“ç±»å®šä¹‰

### Trend Entity (`src/entities/trend.entity.ts`)

åˆ†æ—¶æ•°æ®å®ä½“ç±»ï¼Œå­˜å‚¨åœ¨ `trends` è¡¨ä¸­ã€‚

#### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | é•¿åº¦/ç²¾åº¦ | æ˜¯å¦å¯ç©º | è¯´æ˜ | ç´¢å¼• |
|--------|------|-----------|----------|------|------|
| `id` | number | - | NO | ä¸»é”®IDï¼Œè‡ªåŠ¨ç”Ÿæˆ | ä¸»é”® |
| `code` | string | 20 | NO | è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ï¼š600519ï¼‰ | æ™®é€šç´¢å¼• |
| `name` | string | 100 | NO | è‚¡ç¥¨åç§° | - |
| `datetime` | Date | timestamp | NO | åˆ†æ—¶æ•°æ®çš„æ—¥æœŸæ—¶é—´ | æ™®é€šç´¢å¼• |
| `price` | number | decimal(18,4) | YES | å½“å‰ä»·æ ¼ | - |
| `avgPrice` | number | decimal(18,4) | YES | å‡ä»· | - |
| `volume` | number | bigint | YES | æˆäº¤é‡ï¼ˆè‚¡ï¼‰ | - |
| `amount` | number | decimal(20,4) | YES | æˆäº¤é¢ï¼ˆå…ƒï¼‰ | - |
| `pct` | number | decimal(10,4) | YES | æ¶¨è·Œå¹…ï¼ˆ%ï¼‰ | - |
| `createdAt` | Date | timestamp | NO | ç³»ç»Ÿåˆ›å»ºæ—¶é—´ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ | - |
| `updatedAt` | Date | timestamp | NO | ç³»ç»Ÿæ›´æ–°æ—¶é—´ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰ | - |

#### ç´¢å¼•è®¾è®¡
- **ä¸»é”®ç´¢å¼•**: `id`
- **æ™®é€šç´¢å¼•**: `code` - ç”¨äºæŒ‰è‚¡ç¥¨ä»£ç å¿«é€ŸæŸ¥è¯¢
- **æ™®é€šç´¢å¼•**: `datetime` - ç”¨äºæŒ‰æ—¶é—´èŒƒå›´å¿«é€ŸæŸ¥è¯¢

#### æ•°æ®è½¬æ¢å™¨
å®ä½“ç±»ä½¿ç”¨äº† TypeORM çš„ `transformer` ç‰¹æ€§ï¼Œç¡®ä¿æ•°å€¼ç±»å‹åœ¨æ•°æ®åº“å’Œåº”ç”¨å±‚ä¹‹é—´æ­£ç¡®è½¬æ¢ï¼š
- `price`, `avgPrice`, `amount`, `pct`: decimal â†’ number (ä½¿ç”¨ `parseFloat`)
- `volume`: bigint â†’ number (ä½¿ç”¨ `parseInt`)

---

## DTOs (æ•°æ®ä¼ è¾“å¯¹è±¡)

### CreateTrendDto

ç”¨äºåˆ›å»ºåˆ†æ—¶æ•°æ®çš„DTOã€‚

```typescript
interface CreateTrendDto {
  code: string;        // è‚¡ç¥¨ä»£ç 
  name: string;        // è‚¡ç¥¨åç§°
  datetime: Date;      // æ—¥æœŸæ—¶é—´
  price?: number;      // å½“å‰ä»·æ ¼ï¼ˆå¯é€‰ï¼‰
  avgPrice?: number;   // å‡ä»·ï¼ˆå¯é€‰ï¼‰
  volume?: number;     // æˆäº¤é‡ï¼ˆå¯é€‰ï¼‰
  amount?: number;     // æˆäº¤é¢ï¼ˆå¯é€‰ï¼‰
  pct?: number;        // æ¶¨è·Œå¹…ï¼ˆå¯é€‰ï¼‰
}
```

### TrendQueryDto

ç”¨äºæŸ¥è¯¢åˆ†æ—¶æ•°æ®çš„DTOã€‚

```typescript
interface TrendQueryDto {
  code?: string;           // è‚¡ç¥¨ä»£ç ï¼ˆå¯é€‰ï¼‰
  startDatetime?: string;  // å¼€å§‹æ—¶é—´ï¼ˆå¯é€‰ï¼‰
  endDatetime?: string;    // ç»“æŸæ—¶é—´ï¼ˆå¯é€‰ï¼‰
  page?: number;           // é¡µç ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼‰
  limit?: number;          // æ¯é¡µæ•°é‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤10ï¼‰
}
```

---

## API æ¥å£

### 1. åŒæ­¥åˆ†æ—¶æ•°æ®

**æ¥å£**: `POST /trends/sync-from-api`

**æè¿°**: ä»ä¸œæ–¹è´¢å¯ŒSDKåŒæ­¥åˆ†æ—¶æ•°æ®åˆ°æ•°æ®åº“ï¼ˆå¢é‡æ›´æ–°ï¼‰

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| `code` | string | æ˜¯ | è‚¡ç¥¨ä»£ç  | `"600519"` |
| `market` | number | æ˜¯ | å¸‚åœºä»£ç ï¼ˆ1=ä¸Šäº¤æ‰€ï¼Œ0=æ·±äº¤æ‰€ï¼‰ | `1` |
| `ndays` | number | å¦ | è·å–å¤©æ•°ï¼ˆ1=å½“æ—¥åˆ†æ—¶ï¼Œ5=5æ—¥åˆ†æ—¶ï¼Œé»˜è®¤1ï¼‰ | `1` æˆ– `5` |

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "code": "600519",
  "market": 1,
  "ndays": 1
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "synced": 240,      // APIè¿”å›çš„æ•°æ®æ€»æ•°
  "total": 240,       // æ•°æ®åº“ä¸­è¯¥æ—¶é—´èŒƒå›´å†…çš„æ€»æ•°æ®é‡
  "newAdded": 50      // æœ¬æ¬¡æ–°å¢çš„æ•°æ®æ¡æ•°
}
```

**åŠŸèƒ½è¯´æ˜**:
- ä½¿ç”¨ `eastmoney-data-sdk` çš„ `trend` æ–¹æ³•è·å–åˆ†æ—¶æ•°æ®
- é‡‡ç”¨å¢é‡æ›´æ–°ç­–ç•¥ï¼Œåªæ’å…¥æ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„æ–°æ•°æ®
- è‡ªåŠ¨å°†APIè¿”å›çš„å­—ç¬¦ä¸²æ—¶é—´è½¬æ¢ä¸º `Date` å¯¹è±¡
- é€šè¿‡æ—¶é—´æˆ³æ¯”è¾ƒé¿å…é‡å¤æ’å…¥æ•°æ®

---

### 2. æŸ¥è¯¢åˆ†æ—¶æ•°æ®åˆ—è¡¨

**æ¥å£**: `POST /trends/list`

**æè¿°**: è·å–åˆ†æ—¶æ•°æ®åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’Œæ—¶é—´èŒƒå›´è¿‡æ»¤

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| `code` | string | å¦ | è‚¡ç¥¨ä»£ç  | `"600519"` |
| `ndays` | number | å¦ | è·å–æœ€è¿‘Nå¤©çš„æ•°æ®ï¼ˆ1æˆ–5ï¼Œä¼˜å…ˆçº§é«˜äºæ—¶é—´èŒƒå›´ï¼‰ | `1` |
| `startDatetime` | string | å¦ | å¼€å§‹æ—¶é—´ï¼ˆæ ¼å¼ï¼šYYYY-MM-DD HH:mmï¼‰ | `"2026-01-21 09:30"` |
| `endDatetime` | string | å¦ | ç»“æŸæ—¶é—´ï¼ˆæ ¼å¼ï¼šYYYY-MM-DD HH:mmï¼‰ | `"2026-01-21 15:00"` |
| `page` | number | å¦ | é¡µç ï¼ˆé»˜è®¤1ï¼‰ | `1` |
| `limit` | number | å¦ | æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰ | `100` |

**è¯·æ±‚ç¤ºä¾‹ 1 - ä½¿ç”¨ ndays**:
```json
{
  "code": "600519",
  "ndays": 1,
  "page": 1,
  "limit": 100
}
```

**è¯·æ±‚ç¤ºä¾‹ 2 - ä½¿ç”¨æ—¶é—´èŒƒå›´**:
```json
{
  "code": "600519",
  "startDatetime": "2026-01-21 09:30",
  "endDatetime": "2026-01-21 15:00",
  "page": 1,
  "limit": 100
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "trends": [
    {
      "id": 1,
      "code": "600519",
      "name": "è´µå·èŒ…å°",
      "datetime": "2026-01-21T09:30:00.000Z",
      "price": 1850.50,
      "avgPrice": 1850.50,
      "volume": 12500,
      "amount": 23131250.00,
      "pct": 0.50,
      "createdAt": "2026-01-21T14:30:00.000Z",
      "updatedAt": "2026-01-21T14:30:00.000Z"
    }
    // ... æ›´å¤šæ•°æ®
  ],
  "total": 240
}
```

**åŠŸèƒ½è¯´æ˜**:
- æ”¯æŒæŒ‰è‚¡ç¥¨ä»£ç è¿‡æ»¤
- æ”¯æŒä¸¤ç§æ—¶é—´èŒƒå›´æŒ‡å®šæ–¹å¼ï¼š
  - `ndays`: è‡ªåŠ¨è®¡ç®—æ—¶é—´èŒƒå›´ï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼‰
  - `startDatetime` + `endDatetime`: æ‰‹åŠ¨æŒ‡å®šæ—¶é—´èŒƒå›´
- è¿”å›ç»“æœæŒ‰ `datetime` é™åºæ’åˆ—
- æ”¯æŒåˆ†é¡µæŸ¥è¯¢

---

### 3. æ‰¹é‡åˆ é™¤åˆ†æ—¶æ•°æ®

**æ¥å£**: `POST /trends/delete-range`

**æè¿°**: æ ¹æ®è‚¡ç¥¨ä»£ç å’Œæ—¶é—´èŒƒå›´æ‰¹é‡åˆ é™¤åˆ†æ—¶æ•°æ®

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| `code` | string | æ˜¯ | è‚¡ç¥¨ä»£ç  | `"600519"` |
| `startDatetime` | string | æ˜¯ | å¼€å§‹æ—¶é—´ | `"2026-01-15 09:30"` |
| `endDatetime` | string | æ˜¯ | ç»“æŸæ—¶é—´ | `"2026-01-15 15:00"` |

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "code": "600519",
  "startDatetime": "2026-01-15 09:30",
  "endDatetime": "2026-01-15 15:00"
}
```

**å“åº”**: æ— å“åº”ä½“ï¼ˆæˆåŠŸè¿”å› 200 çŠ¶æ€ç ï¼‰

**åŠŸèƒ½è¯´æ˜**:
- æ‰¹é‡åˆ é™¤æŒ‡å®šè‚¡ç¥¨ä»£ç å’Œæ—¶é—´èŒƒå›´å†…çš„æ‰€æœ‰åˆ†æ—¶æ•°æ®
- ä½¿ç”¨ TypeORM çš„ `Between` æ“ä½œç¬¦è¿›è¡Œæ—¶é—´èŒƒå›´è¿‡æ»¤
- é€‚ç”¨äºæ¸…ç†é”™è¯¯æ•°æ®æˆ–è¿‡æœŸæ•°æ®

---

## Service æ–¹æ³•

### TrendsService

#### ä¸»è¦æ–¹æ³•

##### 1. `createTrends(createTrendDtos: CreateTrendDto[]): Promise<Trend[]>`

æ‰¹é‡åˆ›å»ºåˆ†æ—¶æ•°æ®ã€‚

**å‚æ•°**:
- `createTrendDtos`: åˆ†æ—¶æ•°æ®DTOæ•°ç»„

**è¿”å›**: åˆ›å»ºçš„åˆ†æ—¶æ•°æ®å®ä½“æ•°ç»„

---

##### 2. `findAllTrends(queryDto: TrendQueryDto): Promise<{ trends: Trend[]; total: number }>`

æŸ¥è¯¢åˆ†æ—¶æ•°æ®åˆ—è¡¨ã€‚

**å‚æ•°**:
- `queryDto`: æŸ¥è¯¢æ¡ä»¶DTO

**è¿”å›**: åŒ…å«åˆ†æ—¶æ•°æ®æ•°ç»„å’Œæ€»æ•°çš„å¯¹è±¡

**æŸ¥è¯¢é€»è¾‘**:
- æ”¯æŒæŒ‰ `code` è¿‡æ»¤
- æ”¯æŒæŒ‰æ—¶é—´èŒƒå›´è¿‡æ»¤ï¼ˆ`Between` æ“ä½œï¼‰
- æŒ‰ `datetime` é™åºæ’åº
- æ”¯æŒåˆ†é¡µï¼ˆ`skip` + `take`ï¼‰

---

##### 3. `removeTrendsByRange(code: string, startDatetime: string, endDatetime: string): Promise<void>`

æ ¹æ®è‚¡ç¥¨ä»£ç å’Œæ—¶é—´èŒƒå›´åˆ é™¤åˆ†æ—¶æ•°æ®ã€‚

**å‚æ•°**:
- `code`: è‚¡ç¥¨ä»£ç 
- `startDatetime`: å¼€å§‹æ—¶é—´ï¼ˆå­—ç¬¦ä¸²ï¼‰
- `endDatetime`: ç»“æŸæ—¶é—´ï¼ˆå­—ç¬¦ä¸²ï¼‰

**è¿”å›**: æ— è¿”å›å€¼

---

##### 4. `syncTrendFromAPI(code: string, market: number, ndays: number): Promise<{ synced: number; total: number; newAdded: number }>`

ä»ä¸œæ–¹è´¢å¯ŒSDKåŒæ­¥åˆ†æ—¶æ•°æ®åˆ°æ•°æ®åº“ï¼ˆå¢é‡æ›´æ–°ï¼‰ã€‚

**å‚æ•°**:
- `code`: è‚¡ç¥¨ä»£ç 
- `market`: å¸‚åœºä»£ç ï¼ˆ1=ä¸Šäº¤æ‰€ï¼Œ0=æ·±äº¤æ‰€ï¼‰
- `ndays`: è·å–å¤©æ•°ï¼ˆ1æˆ–5ï¼Œé»˜è®¤1ï¼‰

**è¿”å›**: åŒæ­¥ç»Ÿè®¡ä¿¡æ¯
- `synced`: APIè¿”å›çš„æ•°æ®æ€»æ•°
- `total`: æ•°æ®åº“ä¸­è¯¥æ—¶é—´èŒƒå›´çš„æ€»æ•°æ®é‡
- `newAdded`: æœ¬æ¬¡æ–°å¢çš„æ•°æ®æ¡æ•°

**å®ç°é€»è¾‘**:
1. æ„å»º `secid` (`market.code`)
2. è°ƒç”¨ `eastmoney.trend({ secid, ndays })` è·å–åˆ†æ—¶æ•°æ®
3. è½¬æ¢æ•°æ®æ ¼å¼ï¼ˆå­—ç¬¦ä¸²æ—¶é—´ â†’ Dateå¯¹è±¡ï¼‰
4. æŸ¥è¯¢æ•°æ®åº“ä¸­å·²å­˜åœ¨çš„æ•°æ®
5. æ„å»ºå·²å­˜åœ¨æ•°æ®çš„æ—¶é—´æˆ³é›†åˆ
6. è¿‡æ»¤å‡ºéœ€è¦æ–°å¢çš„æ•°æ®ï¼ˆå¢é‡ç­–ç•¥ï¼‰
7. æ‰¹é‡æ’å…¥æ–°æ•°æ®

**é”™è¯¯å¤„ç†**:
- æ•è·æ‰€æœ‰å¼‚å¸¸å¹¶è®°å½•æ—¥å¿—
- æŠ›å‡ºåŒ…å«é”™è¯¯è¯¦æƒ…çš„å¼‚å¸¸

---

##### 5. `handleDailyCleanupOldTrends()`: å®šæ—¶æ¸…ç†ä»»åŠ¡

è‡ªåŠ¨æ¸…ç†15å¤©ä»¥å‰çš„åˆ†æ—¶æ•°æ®ï¼ˆæ¯å¤©å‡Œæ™¨0ç‚¹æ‰§è¡Œï¼‰ã€‚

**æ‰§è¡Œæ—¶é—´**: æ¯å¤©å‡Œæ™¨0ç‚¹ï¼ˆä¸­å›½æ—¶åŒºï¼‰

**Cronè¡¨è¾¾å¼**: `'0 0 0 * * *'`

**æ¸…ç†é€»è¾‘**:
1. è®¡ç®—15å¤©å‰çš„æ—¶é—´ç‚¹
2. åˆ é™¤ `datetime < 15å¤©å‰` çš„æ‰€æœ‰æ•°æ®
3. è®°å½•åˆ é™¤çš„æ•°æ®æ¡æ•°

**é”™è¯¯å¤„ç†**:
- æ•è·å¼‚å¸¸å¹¶è®°å½•é”™è¯¯æ—¥å¿—
- ä¸ä¼šä¸­æ–­åº”ç”¨è¿è¡Œ

---

## æ¨¡å—é…ç½®

### TrendsModule (`src/trends/trends.module.ts`)

```typescript
@Module({
  imports: [TypeOrmModule.forFeature([Trend])],  // å¯¼å…¥ Trend å®ä½“
  controllers: [TrendsController],                // æ³¨å†Œæ§åˆ¶å™¨
  providers: [TrendsService],                     // æ³¨å†ŒæœåŠ¡
  exports: [TrendsService],                       // å¯¼å‡ºæœåŠ¡ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨
})
export class TrendsModule {}
```

**è¯´æ˜**:
- ä½¿ç”¨ TypeORM ç®¡ç† `Trend` å®ä½“
- å¯¼å‡º `TrendsService` ä¾›å…¶ä»–æ¨¡å—ï¼ˆå¦‚ `QuotesModule`ï¼‰ä½¿ç”¨

---

## æ•°æ®æµç¨‹

### 1. æ•°æ®åŒæ­¥æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ â†’ POST /trends/sync-from-api
    â†“
TrendsController â†’ syncTrendFromAPI()
    â†“
TrendsService â†’ syncTrendFromAPI()
    â†“
eastmoney-data-sdk â†’ trend({ secid, ndays })
    â†“
æ•°æ®è½¬æ¢ (å­—ç¬¦ä¸²æ—¶é—´ â†’ Dateå¯¹è±¡)
    â†“
æŸ¥è¯¢å·²å­˜åœ¨æ•°æ® â†’ è¿‡æ»¤æ–°æ•°æ®ï¼ˆå¢é‡æ›´æ–°ï¼‰
    â†“
æ‰¹é‡æ’å…¥æ–°æ•°æ® â†’ createTrends()
    â†“
è¿”å›ç»Ÿè®¡ä¿¡æ¯ { synced, total, newAdded }
```

### 2. æ•°æ®æŸ¥è¯¢æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ â†’ POST /trends/list
    â†“
TrendsController â†’ findAllTrends()
    â†“
å‚æ•°å¤„ç†ï¼ˆndays è½¬æ¢ä¸ºæ—¶é—´èŒƒå›´ï¼‰
    â†“
TrendsService â†’ findAllTrends(queryDto)
    â†“
æ„å»ºæŸ¥è¯¢æ¡ä»¶ (code, datetimeèŒƒå›´)
    â†“
TypeORM æŸ¥è¯¢ â†’ findAndCount()
    â†“
è¿”å›ç»“æœ { trends, total }
```

### 3. æ•°æ®æ¸…ç†æµç¨‹

```
å®šæ—¶ä»»åŠ¡è§¦å‘ï¼ˆæ¯å¤©å‡Œæ™¨0ç‚¹ï¼‰
    â†“
TrendsService â†’ handleDailyCleanupOldTrends()
    â†“
è®¡ç®—15å¤©å‰çš„æ—¶é—´ç‚¹
    â†“
TypeORM åˆ é™¤ (datetime < 15å¤©å‰)
    â†“
è®°å½•åˆ é™¤çš„æ•°æ®æ¡æ•°
```

---

## æ•°æ®åº“è¡¨ç»“æ„

### è¡¨å: `trends`

```sql
CREATE TABLE `trends` (
  `id` INT AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®ID',
  `code` VARCHAR(20) NOT NULL COMMENT 'è‚¡ç¥¨ä»£ç ',
  `name` VARCHAR(100) NOT NULL COMMENT 'è‚¡ç¥¨åç§°',
  `datetime` TIMESTAMP NOT NULL COMMENT 'æ—¥æœŸæ—¶é—´',
  `price` DECIMAL(18,4) NULL COMMENT 'å½“å‰ä»·æ ¼',
  `avgPrice` DECIMAL(18,4) NULL COMMENT 'å‡ä»·',
  `volume` BIGINT NULL COMMENT 'æˆäº¤é‡ï¼ˆè‚¡ï¼‰',
  `amount` DECIMAL(20,4) NULL COMMENT 'æˆäº¤é¢ï¼ˆå…ƒï¼‰',
  `pct` DECIMAL(10,4) NULL COMMENT 'æ¶¨è·Œå¹…ï¼ˆ%ï¼‰',
  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'ç³»ç»Ÿåˆ›å»ºæ—¶é—´',
  `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ç³»ç»Ÿæ›´æ–°æ—¶é—´',
  INDEX `idx_code` (`code`),
  INDEX `idx_datetime` (`datetime`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

## æœ€ä½³å®è·µ

### 1. æ•°æ®åŒæ­¥

**å»ºè®®**:
- ä½¿ç”¨ `ndays=1` è·å–å½“æ—¥åˆ†æ—¶æ•°æ®ï¼ˆå®æ—¶æ€§æ›´é«˜ï¼‰
- ä½¿ç”¨ `ndays=5` è·å–5æ—¥åˆ†æ—¶æ•°æ®ï¼ˆé€‚åˆè¡¥å…¨å†å²æ•°æ®ï¼‰
- å®šæ—¶åŒæ­¥ï¼šå»ºè®®åœ¨äº¤æ˜“æ—¶é—´å†…æ¯åˆ†é’ŸåŒæ­¥ä¸€æ¬¡
- å¢é‡æ›´æ–°ç­–ç•¥ç¡®ä¿ä¸ä¼šé‡å¤æ’å…¥æ•°æ®

**ç¤ºä¾‹**:
```typescript
// åŒæ­¥å½“æ—¥åˆ†æ—¶æ•°æ®
await trendsService.syncTrendFromAPI('600519', 1, 1);

// åŒæ­¥5æ—¥åˆ†æ—¶æ•°æ®
await trendsService.syncTrendFromAPI('600519', 1, 5);
```

### 2. æ•°æ®æŸ¥è¯¢

**å»ºè®®**:
- ä¼˜å…ˆä½¿ç”¨ `ndays` å‚æ•°ï¼Œç®€åŒ–æ—¶é—´èŒƒå›´è®¡ç®—
- åˆç†è®¾ç½® `limit`ï¼Œé¿å…ä¸€æ¬¡æ€§æŸ¥è¯¢è¿‡å¤šæ•°æ®
- åˆ©ç”¨ `code` å’Œ `datetime` ç´¢å¼•æå‡æŸ¥è¯¢æ€§èƒ½

**ç¤ºä¾‹**:
```typescript
// æŸ¥è¯¢æŸè‚¡ç¥¨å½“æ—¥åˆ†æ—¶æ•°æ®
await trendsService.findAllTrends({
  code: '600519',
  ndays: 1,
  limit: 500
});

// æŸ¥è¯¢æŸè‚¡ç¥¨ç‰¹å®šæ—¶é—´èŒƒå›´çš„åˆ†æ—¶æ•°æ®
await trendsService.findAllTrends({
  code: '600519',
  startDatetime: '2026-01-21 09:30',
  endDatetime: '2026-01-21 15:00',
  limit: 500
});
```

### 3. æ•°æ®æ¸…ç†

**å»ºè®®**:
- ä¾èµ–è‡ªåŠ¨æ¸…ç†ä»»åŠ¡ï¼Œæ— éœ€æ‰‹åŠ¨æ¸…ç†å†å²æ•°æ®
- å¦‚éœ€ä¿ç•™æ›´é•¿æ—¶é—´çš„æ•°æ®ï¼Œå¯è°ƒæ•´æ¸…ç†ä»»åŠ¡çš„æ—¶é—´é˜ˆå€¼ï¼ˆé»˜è®¤15å¤©ï¼‰
- ä½¿ç”¨ `delete-range` æ¥å£æ¸…ç†ç‰¹å®šé”™è¯¯æ•°æ®

---

## ä¾èµ–é¡¹

### å¤–éƒ¨ä¾èµ–
- `eastmoney-data-sdk`: ä¸œæ–¹è´¢å¯Œæ•°æ®SDKï¼Œç”¨äºè·å–åˆ†æ—¶æ•°æ®
- `typeorm`: ORMæ¡†æ¶ï¼Œç”¨äºæ•°æ®åº“æ“ä½œ
- `@nestjs/typeorm`: NestJSçš„TypeORMé›†æˆ
- `@nestjs/schedule`: NestJSå®šæ—¶ä»»åŠ¡æ¨¡å—

### å†…éƒ¨ä¾èµ–
- `Trend` å®ä½“ (`src/entities/trend.entity.ts`)

---

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

1. **APIè¿”å›æ•°æ®ä¸ºç©º**
   - **åŸå› **: è‚¡ç¥¨ä»£ç é”™è¯¯ã€å¸‚åœºä»£ç é”™è¯¯ã€éäº¤æ˜“æ—¶é—´
   - **æ—¥å¿—**: `âš ï¸  è‚¡ç¥¨ ${code} æœªè·å–åˆ°åˆ†æ—¶æ•°æ®`
   - **è§£å†³**: æ£€æŸ¥è‚¡ç¥¨ä»£ç å’Œå¸‚åœºä»£ç æ˜¯å¦æ­£ç¡®

2. **æ•°æ®åŒæ­¥å¤±è´¥**
   - **åŸå› **: ç½‘ç»œé—®é¢˜ã€APIå¼‚å¸¸ã€æ•°æ®åº“è¿æ¥å¤±è´¥
   - **æ—¥å¿—**: `âŒ åŒæ­¥è‚¡ç¥¨ ${code} åˆ†æ—¶æ•°æ®å¤±è´¥`
   - **è§£å†³**: æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—ï¼Œæ£€æŸ¥ç½‘ç»œå’Œæ•°æ®åº“è¿æ¥

3. **å®šæ—¶æ¸…ç†ä»»åŠ¡å¤±è´¥**
   - **åŸå› **: æ•°æ®åº“è¿æ¥å¤±è´¥ã€æƒé™é—®é¢˜
   - **æ—¥å¿—**: `âŒ åˆ†æ—¶æ•°æ®æ¸…ç†ä»»åŠ¡æ‰§è¡Œå¤±è´¥`
   - **è§£å†³**: æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—ï¼Œæ£€æŸ¥æ•°æ®åº“è¿æ¥å’Œæƒé™

---

## æ—¥å¿—è¯´æ˜

### æ—¥å¿—çº§åˆ«

- `LOG`: æ­£å¸¸æ“ä½œæ—¥å¿—
- `WARN`: è­¦å‘Šæ—¥å¿—ï¼ˆæ•°æ®ä¸ºç©ºç­‰éè‡´å‘½é—®é¢˜ï¼‰
- `ERROR`: é”™è¯¯æ—¥å¿—ï¼ˆåŒæ­¥å¤±è´¥ã€æ¸…ç†å¤±è´¥ç­‰ï¼‰

### æ—¥å¿—ç¤ºä¾‹

```
ğŸ“Š å¼€å§‹è·å–è‚¡ç¥¨ 600519 çš„ 1 æ—¥åˆ†æ—¶æ•°æ®...
ğŸ“Š æ•°æ®ç»Ÿè®¡: APIè¿”å› 240 æ¡, å·²å­˜åœ¨ 190 æ¡, æ–°å¢ 50 æ¡
ğŸ’¾ å¼€å§‹æ’å…¥ 50 æ¡æ–°åˆ†æ—¶æ•°æ®...
âœ… åˆ†æ—¶æ•°æ®æ’å…¥æˆåŠŸ
ğŸ§¹ å¼€å§‹æ‰§è¡Œåˆ†æ—¶æ•°æ®æ¸…ç†ä»»åŠ¡...
ğŸ“… æ¸…ç†æ—¶é—´èŠ‚ç‚¹: 2026-01-07T00:00:00.000Z (15å¤©å‰)
âœ… åˆ†æ—¶æ•°æ®æ¸…ç†å®Œæˆ - åˆ é™¤äº† 5000 æ¡è®°å½•
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç´¢å¼•ä¼˜åŒ–**
   - å·²åœ¨ `code` å’Œ `datetime` å­—æ®µä¸Šå»ºç«‹ç´¢å¼•
   - æŸ¥è¯¢æ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªå­—æ®µå¯è·å¾—æœ€ä½³æ€§èƒ½

2. **æ‰¹é‡æ“ä½œ**
   - ä½¿ç”¨ `createTrends()` æ‰¹é‡æ’å…¥ï¼Œé¿å…é€æ¡æ’å…¥
   - ä½¿ç”¨ `delete-range` æ‰¹é‡åˆ é™¤ï¼Œé¿å…é€æ¡åˆ é™¤

3. **å¢é‡æ›´æ–°**
   - åŒæ­¥æ•°æ®æ—¶é‡‡ç”¨å¢é‡æ›´æ–°ç­–ç•¥ï¼Œåªæ’å…¥æ–°æ•°æ®
   - ä½¿ç”¨æ—¶é—´æˆ³æ¯”è¾ƒï¼ˆ`getTime()`ï¼‰ï¼Œæ€§èƒ½ä¼˜äºå­—ç¬¦ä¸²æ¯”è¾ƒ

4. **å®šæ—¶æ¸…ç†**
   - è‡ªåŠ¨æ¸…ç†15å¤©ä»¥å‰çš„æ•°æ®ï¼Œä¿æŒè¡¨å¤§å°åˆç†
   - å‡å°‘å­˜å‚¨ç©ºé—´å ç”¨ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½

5. **åˆ†é¡µæŸ¥è¯¢**
   - æŸ¥è¯¢å¤§é‡æ•°æ®æ—¶ä½¿ç”¨åˆ†é¡µï¼Œé¿å…å†…å­˜æº¢å‡º
   - åˆç†è®¾ç½® `limit`ï¼Œå»ºè®®ä¸è¶…è¿‡1000æ¡

---

## ç‰ˆæœ¬å†å²

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- âœ… å®ç°åˆ†æ—¶æ•°æ®å®ä½“ç±»å®šä¹‰
- âœ… å®ç°ä»ä¸œæ–¹è´¢å¯ŒSDKåŒæ­¥åˆ†æ—¶æ•°æ®ï¼ˆå¢é‡æ›´æ–°ï¼‰
- âœ… å®ç°åˆ†æ—¶æ•°æ®æŸ¥è¯¢ï¼ˆæ”¯æŒåˆ†é¡µã€æ—¶é—´èŒƒå›´è¿‡æ»¤ï¼‰
- âœ… å®ç°æŒ‰æ—¶é—´èŒƒå›´æ‰¹é‡åˆ é™¤åˆ†æ—¶æ•°æ®
- âœ… å®ç°å®šæ—¶æ¸…ç†15å¤©ä»¥å‰çš„å†å²æ•°æ®
- âœ… é‡‡ç”¨ `Date` ç±»å‹å­˜å‚¨æ—¶é—´ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
- âœ… ç§»é™¤ä¸å¿…è¦çš„å•æ¡CRUDæ¥å£ï¼Œç®€åŒ–API
- âœ… ä¼˜åŒ–æ•°æ®åŒæ­¥é€»è¾‘ï¼Œä½¿ç”¨å¢é‡æ›´æ–°ç­–ç•¥

---

## ç›¸å…³æ¨¡å—

- **QuotesModule**: å®æ—¶è¡Œæƒ…æ¨¡å—ï¼Œå¯èƒ½ä¼šè°ƒç”¨ `TrendsService` çš„æ–¹æ³•
- **StockModule**: è‚¡ç¥¨åŸºç¡€ä¿¡æ¯æ¨¡å—

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚
