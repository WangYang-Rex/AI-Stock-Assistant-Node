# è‚¡ç¥¨åŠ©æ‰‹ç³»ç»Ÿ - å®ä½“å…³ç³»å›¾ (ERD)

## ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»ŸåŒ…å« 5 ä¸ªæ ¸å¿ƒå®ä½“ï¼Œç”¨äºç®¡ç†è‚¡ç¥¨æ•°æ®ã€Kçº¿æ•°æ®ã€å®æ—¶è¡Œæƒ…ã€äº¤æ˜“è®°å½•å’Œ AI ä¿¡å·ã€‚

## å®ä½“è¯¦ç»†è¯´æ˜

### 1. ğŸ“Š Stock (stocks) - è‚¡ç¥¨åŸºç¡€ä¿¡æ¯è¡¨

**ç”¨é€”**: å­˜å‚¨è‚¡ç¥¨çš„åŸºæœ¬ä¿¡æ¯å’ŒæŒä»“æ•°æ®

**æ ¸å¿ƒå­—æ®µ**:
- ğŸ”‘ `id`: ä¸»é”®
- ğŸ”’ `code`: è‚¡ç¥¨ä»£ç ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰
- `name`: è‚¡ç¥¨åç§°
- `market`: å¸‚åœºç±»å‹ï¼ˆSH/SZï¼‰
- `marketCode`: å¸‚åœºä»£ç ï¼ˆ1/0ï¼‰

**ä»·æ ¼ä¿¡æ¯**:
- `pe`: å¸‚ç›ˆç‡
- `latestPrice`: æœ€æ–°ä»·
- `changePercent`: æ¶¨è·Œå¹…
- `changeAmount`: æ¶¨è·Œé¢
- `openPrice`: å¼€ç›˜ä»·
- `highPrice`: æœ€é«˜ä»·
- `lowPrice`: æœ€ä½ä»·
- `previousClosePrice`: æ˜¨æ”¶ä»·
- `volume`: æˆäº¤é‡

**æŒä»“ä¿¡æ¯**:
- `holdingQuantity`: æŒä»“æ•°é‡
- `holdingCost`: æŒä»“æˆæœ¬
- `marketValue`: å¸‚å€¼

**ç´¢å¼•**:
- UNIQUE: `code`
- INDEX: `market`

---

### 2. ğŸ“ˆ Kline (klines) - Kçº¿æ•°æ®è¡¨

**ç”¨é€”**: å­˜å‚¨è‚¡ç¥¨çš„å†å²Kçº¿æ•°æ®ï¼ˆæ—¥çº¿ã€å‘¨çº¿ã€æœˆçº¿ã€åˆ†é’Ÿçº¿ï¼‰

**æ ¸å¿ƒå­—æ®µ**:
- ğŸ”‘ `id`: ä¸»é”®
- `code`: è‚¡ç¥¨ä»£ç ï¼ˆå…³è” Stock.codeï¼‰
- `name`: è‚¡ç¥¨åç§°
- `period`: Kçº¿å‘¨æœŸï¼ˆ101=æ—¥çº¿, 102=å‘¨çº¿, 103=æœˆçº¿, 1/5/15/30/60=åˆ†é’Ÿçº¿ï¼‰
- `date`: æ—¥æœŸ/æ—¶é—´

**ä»·æ ¼æ•°æ®**:
- `open`: å¼€ç›˜ä»·
- `close`: æ”¶ç›˜ä»·
- `high`: æœ€é«˜ä»·
- `low`: æœ€ä½ä»·

**æˆäº¤æ•°æ®**:
- `volume`: æˆäº¤é‡
- `amount`: æˆäº¤é¢

**æŠ€æœ¯æŒ‡æ ‡**:
- `amplitude`: æŒ¯å¹…
- `pct`: æ¶¨è·Œå¹…
- `change`: æ¶¨è·Œé¢
- `turnover`: æ¢æ‰‹ç‡
- `fqType`: å¤æƒç±»å‹ï¼ˆ0=ä¸å¤æƒ, 1=å‰å¤æƒ, 2=åå¤æƒï¼‰

**ç´¢å¼•**:
- UNIQUE: `(code, date, period)` - ç¡®ä¿åŒä¸€è‚¡ç¥¨åŒä¸€æ—¶é—´åŒä¸€å‘¨æœŸçš„æ•°æ®å”¯ä¸€
- INDEX: `code`, `date`

**å…³ç³»**: Stock (1) â†’ Kline (N)
- ä¸€åªè‚¡ç¥¨å¯ä»¥æœ‰å¤šæ¡Kçº¿è®°å½•

---

### 3. ğŸ’¹ Quote (quotes) - å®æ—¶è¡Œæƒ…å¿«ç…§è¡¨

**ç”¨é€”**: å­˜å‚¨è‚¡ç¥¨çš„å®æ—¶è¡Œæƒ…å¿«ç…§æ•°æ®

**æ ¸å¿ƒå­—æ®µ**:
- ğŸ”‘ `id`: ä¸»é”®
- `code`: è‚¡ç¥¨ä»£ç ï¼ˆå…³è” Stock.codeï¼‰
- `name`: è‚¡ç¥¨åç§°
- `marketCode`: å¸‚åœºä»£ç 

**è¡Œæƒ…æ•°æ®**:
- `latestPrice`: æœ€æ–°ä»·
- `changePercent`: æ¶¨è·Œå¹…
- `openPrice`: å¼€ç›˜ä»·
- `volume`: æˆäº¤é‡
- `volumeAmount`: æˆäº¤é¢
- `previousClosePrice`: æ˜¨æ”¶ä»·

**æ—¶é—´æˆ³**:
- `snapshotTime`: å¿«ç…§æ—¶é—´ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰
- `snapshotDate`: å¿«ç…§æ—¥æœŸ

**ç´¢å¼•**:
- INDEX: `code`, `snapshotTime`, `snapshotDate`

**å…³ç³»**: Stock (1) â†’ Quote (N)
- ä¸€åªè‚¡ç¥¨å¯ä»¥æœ‰å¤šä¸ªè¡Œæƒ…å¿«ç…§ï¼ˆç”¨äºå†å²å›æº¯ï¼‰

---

### 4. ğŸ’° Trading (trading_records) - äº¤æ˜“è®°å½•è¡¨

**ç”¨é€”**: è®°å½•è‚¡ç¥¨çš„ä¹°å…¥å’Œå–å‡ºäº¤æ˜“

**æ ¸å¿ƒå­—æ®µ**:
- ğŸ”‘ `id`: ä¸»é”®
- `symbol`: è‚¡ç¥¨ä»£ç ï¼ˆå…³è” Stock.codeï¼‰
- `name`: è‚¡ç¥¨åç§°
- `type`: äº¤æ˜“ç±»å‹ï¼ˆbuy/sellï¼‰
- `tradingTime`: æˆäº¤æ—¶é—´

**äº¤æ˜“æ•°æ®**:
- `quantity`: äº¤æ˜“æ•°é‡ï¼ˆè‚¡ï¼‰
- `price`: æˆäº¤ä»·æ ¼
- `amount`: äº¤æ˜“é‡‘é¢ï¼ˆä»·æ ¼ Ã— æ•°é‡ï¼‰

**å…³è”ä¿¡æ¯**:
- `relatedTradingId`: å…³è”äº¤æ˜“IDï¼ˆç”¨äºå…³è”ä¹°å…¥å’Œå–å‡ºï¼‰
- `remarks`: å¤‡æ³¨

**ç´¢å¼•**:
- INDEX: `symbol`, `tradingTime`, `(symbol, tradingTime)`

**å…³ç³»**: Stock (1) â†’ Trading (N)
- ä¸€åªè‚¡ç¥¨å¯ä»¥æœ‰å¤šæ¡äº¤æ˜“è®°å½•

---

### 5. ğŸ¤– AiSignal (ai_signals) - AIä¿¡å·è¡¨

**ç”¨é€”**: å­˜å‚¨AIæ¨¡å‹ç”Ÿæˆçš„ä¹°å–ä¿¡å·

**æ ¸å¿ƒå­—æ®µ**:
- ğŸ”‘ `id`: ä¸»é”®
- `symbol`: è‚¡ç¥¨ä»£ç ï¼ˆå…³è” Stock.codeï¼‰
- `signalTime`: ä¿¡å·æ—¶é—´
- `signalType`: ä¿¡å·ç±»å‹ï¼ˆbuy/sell/holdï¼‰

**AIä¿¡æ¯**:
- `confidence`: ä¿¡å·ç½®ä¿¡åº¦ï¼ˆ0-100ï¼‰
- `modelVersion`: AIæ¨¡å‹ç‰ˆæœ¬å·
- `description`: ä¿¡å·è¯´æ˜æˆ–æ¨¡å‹è§£é‡Š

**ç´¢å¼•**:
- INDEX: `symbol`, `signalTime`, `signalType`, `modelVersion`
- INDEX: `(symbol, signalTime)`, `(signalType, signalTime)`

**å…³ç³»**: Stock (1) â†’ AiSignal (N)
- ä¸€åªè‚¡ç¥¨å¯ä»¥æœ‰å¤šä¸ªAIä¿¡å·

---

## å®ä½“å…³ç³»æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Stock       â”‚ (ä¸­å¿ƒå®ä½“)
â”‚   (stocks)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
         â”‚ 1:N             â”‚ 1:N
         â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Kline  â”‚       â”‚  Quote  â”‚
    â”‚(klines) â”‚       â”‚(quotes) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Trading  â”‚
    â”‚(trading_ â”‚
    â”‚ records) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ AiSignal  â”‚
    â”‚(ai_signals)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…³ç³»è¯´æ˜

### Stock â†’ Kline (1:N)
- **å…³è”å­—æ®µ**: `Stock.code` = `Kline.code`
- **ä¸šåŠ¡å«ä¹‰**: ä¸€åªè‚¡ç¥¨æœ‰å¤šæ¡Kçº¿å†å²æ•°æ®
- **æŸ¥è¯¢ç¤ºä¾‹**: æŸ¥è¯¢æŸåªè‚¡ç¥¨çš„æ—¥Kçº¿æ•°æ®

### Stock â†’ Quote (1:N)
- **å…³è”å­—æ®µ**: `Stock.code` = `Quote.code`
- **ä¸šåŠ¡å«ä¹‰**: ä¸€åªè‚¡ç¥¨æœ‰å¤šä¸ªè¡Œæƒ…å¿«ç…§
- **æŸ¥è¯¢ç¤ºä¾‹**: æŸ¥è¯¢æŸåªè‚¡ç¥¨ä»Šå¤©çš„è¡Œæƒ…å˜åŒ–

### Stock â†’ Trading (1:N)
- **å…³è”å­—æ®µ**: `Stock.code` = `Trading.symbol`
- **ä¸šåŠ¡å«ä¹‰**: ä¸€åªè‚¡ç¥¨æœ‰å¤šæ¡äº¤æ˜“è®°å½•
- **æŸ¥è¯¢ç¤ºä¾‹**: æŸ¥è¯¢æŸåªè‚¡ç¥¨çš„æ‰€æœ‰ä¹°å–è®°å½•

### Stock â†’ AiSignal (1:N)
- **å…³è”å­—æ®µ**: `Stock.code` = `AiSignal.symbol`
- **ä¸šåŠ¡å«ä¹‰**: ä¸€åªè‚¡ç¥¨æœ‰å¤šä¸ªAIä¿¡å·
- **æŸ¥è¯¢ç¤ºä¾‹**: æŸ¥è¯¢æŸåªè‚¡ç¥¨çš„AIä¹°å–å»ºè®®

## æ•°æ®æµå‘

```
1. æ•°æ®é‡‡é›†
   â†“
2. Stock (åŸºç¡€ä¿¡æ¯) â† ä»APIè·å–å¹¶å­˜å‚¨
   â†“
3. Kline (å†å²æ•°æ®) â† å®šæ—¶åŒæ­¥Kçº¿æ•°æ®
   â†“
4. Quote (å®æ—¶è¡Œæƒ…) â† å®æ—¶é‡‡é›†è¡Œæƒ…å¿«ç…§
   â†“
5. AiSignal (AIåˆ†æ) â† AIæ¨¡å‹åˆ†æç”Ÿæˆä¿¡å·
   â†“
6. Trading (äº¤æ˜“æ‰§è¡Œ) â† æ ¹æ®ä¿¡å·æˆ–æ‰‹åŠ¨æ‰§è¡Œäº¤æ˜“
```

## å…¸å‹æŸ¥è¯¢åœºæ™¯

### åœºæ™¯1: æŸ¥è¯¢è‚¡ç¥¨å®Œæ•´ä¿¡æ¯
```sql
SELECT 
  s.*,
  k.close as latest_kline_close,
  q.latestPrice as realtime_price,
  ai.signalType as ai_signal
FROM stocks s
LEFT JOIN klines k ON s.code = k.code AND k.period = 101
LEFT JOIN quotes q ON s.code = q.code
LEFT JOIN ai_signals ai ON s.code = ai.symbol
WHERE s.code = '600519'
ORDER BY k.date DESC, q.snapshotTime DESC, ai.signalTime DESC
LIMIT 1;
```

### åœºæ™¯2: æŸ¥è¯¢æŒä»“è‚¡ç¥¨çš„ç›ˆäº
```sql
SELECT 
  s.code,
  s.name,
  s.holdingQuantity,
  s.holdingCost,
  q.latestPrice,
  (q.latestPrice - s.holdingCost) * s.holdingQuantity as profit
FROM stocks s
JOIN quotes q ON s.code = q.code
WHERE s.holdingQuantity > 0;
```

### åœºæ™¯3: æŸ¥è¯¢AIä¿¡å·ç»Ÿè®¡
```sql
SELECT 
  s.code,
  s.name,
  COUNT(ai.id) as signal_count,
  AVG(ai.confidence) as avg_confidence
FROM stocks s
JOIN ai_signals ai ON s.code = ai.symbol
WHERE ai.signalType = 'buy'
GROUP BY s.code, s.name
ORDER BY avg_confidence DESC;
```

## ç´¢å¼•ä¼˜åŒ–å»ºè®®

### å·²å®ç°çš„ç´¢å¼•
- âœ… Stock: `code` (UNIQUE), `market`
- âœ… Kline: `(code, date, period)` (UNIQUE), `code`, `date`
- âœ… Quote: `code`, `snapshotTime`, `snapshotDate`
- âœ… Trading: `symbol`, `tradingTime`, `(symbol, tradingTime)`
- âœ… AiSignal: `symbol`, `signalTime`, `signalType`, `modelVersion`, å¤åˆç´¢å¼•

### æ½œåœ¨ä¼˜åŒ–
- è€ƒè™‘ä¸ºé«˜é¢‘æŸ¥è¯¢å­—æ®µæ·»åŠ è¦†ç›–ç´¢å¼•
- å¯¹äºæ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼Œè€ƒè™‘åˆ†åŒºè¡¨
- å¯¹äºå†å²æ•°æ®ï¼Œè€ƒè™‘å½’æ¡£ç­–ç•¥

## æ•°æ®ä¸€è‡´æ€§

### æ³¨æ„äº‹é¡¹
1. **Stock æ˜¯æ ¸å¿ƒè¡¨**: æ‰€æœ‰å…¶ä»–è¡¨éƒ½ä¾èµ– Stock.code
2. **æ— å¤–é”®çº¦æŸ**: å½“å‰è®¾è®¡ä½¿ç”¨é€»è¾‘å…³è”ï¼Œæœªä½¿ç”¨æ•°æ®åº“å¤–é”®
3. **æ•°æ®åŒæ­¥**: Kline å’Œ Quote éœ€è¦å®šæ—¶åŒæ­¥
4. **è½¯åˆ é™¤**: å»ºè®®ä½¿ç”¨è½¯åˆ é™¤è€Œéç‰©ç†åˆ é™¤

### å»ºè®®
- åœ¨åˆ é™¤ Stock è®°å½•å‰ï¼Œå…ˆæ¸…ç†ç›¸å…³çš„ Klineã€Quoteã€Tradingã€AiSignal æ•°æ®
- ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- å®šæœŸæ¸…ç†è¿‡æœŸçš„ Quote å¿«ç…§æ•°æ®

---

**ç”Ÿæˆæ—¶é—´**: 2026-01-19
**ç‰ˆæœ¬**: 1.0
**ç»´æŠ¤è€…**: AI Stock Assistant Team
