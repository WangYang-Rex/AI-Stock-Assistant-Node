å¥½ï¼Œè¿™ä¸€æ­¥å·²ç»è¿›å…¥**ç­–ç•¥æ ¸å¿ƒç®—æ³•å±‚**äº† ğŸ‘
æˆ‘ç›´æ¥ç»™ä½ ä¸€å¥—**å¯è½åœ°çš„ã€Œåˆ†é’Ÿçº§æˆåˆ†è‚¡å…±æŒ¯è¯„åˆ† Indicatorã€è®¾è®¡ + ä»£ç å®ç°**ï¼Œé£æ ¼æŒ‰ä½ ç°åœ¨çš„ **Nest åç«¯ / React å‰ç«¯ / è‡ªç ”é‡åŒ–ç³»ç»Ÿ** æ¥ã€‚

---

## ä¸€ã€å…ˆç»Ÿä¸€ï¼šä»€ä¹ˆå«ã€Œåˆ†é’Ÿçº§å…±æŒ¯ã€

> **å…±æŒ¯ = å¤šåªæˆåˆ†è‚¡åœ¨åŒä¸€æ—¶é—´çª—å£å†…ï¼Œå‘åŒä¸€æ–¹å‘å‘å‡ºâ€œæœ‰æ•ˆä¿¡å·â€**

æˆ‘ä»¬æ‹†æˆ 4 ä¸ªå¯è®¡ç®—ç»´åº¦ï¼ˆéƒ½é€‚åˆåˆ†é’Ÿçº§ï¼‰ï¼š

| ç»´åº¦    | å«ä¹‰       | æ˜¯å¦å¿…é¡» |
| ----- | -------- | ---- |
| æ–¹å‘ä¸€è‡´æ€§ | æ¶¨ / è·Œ    | âœ…    |
| å¹…åº¦å¼ºåº¦  | æ¶¨è·Œå¹…å¤§å°    | âœ…    |
| æƒé‡å½±å“  | ETF ä¸­çš„æƒé‡ | âœ…    |
| åŒæ­¥æ€§   | æ˜¯å¦â€œåŒæ—¶â€å‘ç”Ÿ | âœ…    |

æœ€ç»ˆè¾“å‡ºä¸€ä¸ª **0ï½100 çš„å…±æŒ¯è¯„åˆ†**ã€‚

---

## äºŒã€æ•°æ®è¾“å…¥å®šä¹‰ï¼ˆåˆ†é’Ÿçº§ï¼‰

### 1ï¸âƒ£ æˆåˆ†è‚¡åˆ†é’Ÿè¡Œæƒ…ï¼ˆä½ å‰é¢å·²ç»è®¾è®¡è¿‡ Providerï¼‰

```ts
export interface MinuteBar {
  ts: number;        // æ—¶é—´æˆ³ï¼ˆåˆ†é’Ÿï¼‰
  open: number;
  high: number;
  low: number;
  close: number;
  volume: number;
}
```

### 2ï¸âƒ£ ETF æˆåˆ†è‚¡æƒé‡

```ts
export interface EtfComponent {
  code: string;      // 688xxx
  name: string;
  weight: number;   // 0.0823ï¼ˆ8.23%ï¼‰
}
```

### 3ï¸âƒ£ Indicator è¾“å…¥ç»“æ„

```ts
export interface ResonanceInput {
  ts: number; // å½“å‰åˆ†é’Ÿ
  barsMap: Record<string, MinuteBar[]>; // code -> æœ€è¿‘ N åˆ†é’Ÿ
  components: EtfComponent[];
}
```

---

## ä¸‰ã€å…±æŒ¯è¯„åˆ†æ‹†è§£å…¬å¼ï¼ˆæ ¸å¿ƒï¼‰

### 1ï¸âƒ£ å•åªè‚¡ç¥¨çš„ã€Œåˆ†é’ŸåŠ¨é‡å¾—åˆ†ã€

```ts
function calcMomentumScore(bars: MinuteBar[]): number {
  if (bars.length < 2) return 0;

  const last = bars[bars.length - 1];
  const prev = bars[bars.length - 2];

  const pct = (last.close - prev.close) / prev.close;

  // æ”¾å¤§åˆ†é’Ÿå˜åŒ–ï¼Œä½†é˜²æ­¢æç«¯å€¼
  return Math.max(-1, Math.min(1, pct * 100));
}
```

> è¾“å‡ºèŒƒå›´ï¼š`[-1, 1]`

---

### 2ï¸âƒ£ æ–¹å‘ä¸€è‡´æ€§ï¼ˆDirection Consistencyï¼‰

```ts
function calcDirectionConsistency(scores: number[]): number {
  const up = scores.filter(s => s > 0).length;
  const down = scores.filter(s => s < 0).length;
  const total = scores.length;

  return Math.abs(up - down) / total; // 0ï½1
}
```

---

### 3ï¸âƒ£ æƒé‡åŠ æƒå¼ºåº¦ï¼ˆWeighted Strengthï¼‰

```ts
function calcWeightedStrength(
  scores: number[],
  weights: number[],
): number {
  let sum = 0;

  for (let i = 0; i < scores.length; i++) {
    sum += scores[i] * weights[i];
  }

  return Math.max(-1, Math.min(1, sum));
}
```

---

### 4ï¸âƒ£ åŒæ­¥æ€§ï¼ˆMinute Syncï¼‰

> çœ‹æœ‰å¤šå°‘æˆåˆ†è‚¡ **åŒä¸€åˆ†é’Ÿè§¦å‘æœ‰æ•ˆä¿¡å·**

```ts
function calcSyncRatio(scores: number[], threshold = 0.2): number {
  const active = scores.filter(s => Math.abs(s) >= threshold).length;
  return active / scores.length;
}
```

---

## å››ã€æœ€ç»ˆï¼šå…±æŒ¯è¯„åˆ†è®¡ç®—å™¨ï¼ˆæ ¸å¿ƒ Indicatorï¼‰

```ts
export interface ResonanceScore {
  ts: number;
  score: number;      // 0ï½100
  direction: 'UP' | 'DOWN' | 'NEUTRAL';
  detail: {
    directionConsistency: number;
    weightedStrength: number;
    syncRatio: number;
  };
}
```

### ä¸»è®¡ç®—å‡½æ•° ğŸ‘‡

```ts
export function calcMinuteResonanceScore(
  input: ResonanceInput,
): ResonanceScore {
  const scores: number[] = [];
  const weights: number[] = [];

  for (const c of input.components) {
    const bars = input.barsMap[c.code];
    if (!bars || bars.length < 2) continue;

    scores.push(calcMomentumScore(bars));
    weights.push(c.weight);
  }

  if (scores.length === 0) {
    return {
      ts: input.ts,
      score: 0,
      direction: 'NEUTRAL',
      detail: {
        directionConsistency: 0,
        weightedStrength: 0,
        syncRatio: 0,
      },
    };
  }

  const directionConsistency = calcDirectionConsistency(scores);
  const weightedStrength = calcWeightedStrength(scores, weights);
  const syncRatio = calcSyncRatio(scores);

  // ç»¼åˆè¯„åˆ†ï¼ˆå¯è°ƒæƒé‡ï¼‰
  const rawScore =
    directionConsistency * 0.4 +
    Math.abs(weightedStrength) * 0.4 +
    syncRatio * 0.2;

  const score = Math.round(rawScore * 100);

  return {
    ts: input.ts,
    score,
    direction:
      weightedStrength > 0.05
        ? 'UP'
        : weightedStrength < -0.05
        ? 'DOWN'
        : 'NEUTRAL',
    detail: {
      directionConsistency,
      weightedStrength,
      syncRatio,
    },
  };
}
```

---

## äº”ã€å¦‚ä½•æ¥è¿›ä½ çš„ Strategy å›æµ‹å¼•æ“

### åœ¨ Strategy æ‰§è¡Œå¾ªç¯ä¸­ï¼š

```ts
for (const minute of timeline) {
  const resonance = calcMinuteResonanceScore({
    ts: minute,
    barsMap: minuteBarsMap,
    components: etfComponents,
  });

  if (resonance.score >= 70 && resonance.direction === 'UP') {
    signal.push({
      ts: minute,
      type: 'BUY',
      reason: 'COMPONENT_RESONANCE',
      score: resonance.score,
    });
  }
}
```

---

## å…­ã€å‰ç«¯ React æ€ä¹ˆç”»ï¼ˆç®€è¿°ï¼‰

ä½ å¯ä»¥åœ¨ **ETF åˆ†é’Ÿ K çº¿ä¸‹æ–¹å ä¸€æ¡æŒ‡æ ‡çº¿**ï¼š

* Y è½´ï¼š0ï½100
* é¢œè‰²ï¼š

  * â‰¥70ï¼šçº¢è‰²ï¼ˆå¼ºå…±æŒ¯ï¼‰
  * â‰¤30ï¼šç»¿è‰²ï¼ˆä¸‹è¡Œå…±æŒ¯ï¼‰
  * ä¸­é—´ï¼šç°è‰²

å­—æ®µç›´æ¥ç”¨ï¼š

```ts
{
  ts,
  resonanceScore,
  direction
}
```

---

## ä¸ƒã€ä¸‹ä¸€æ­¥æˆ‘å»ºè®®ä½ ç»§ç»­åšçš„ 3 ä»¶äº‹ï¼ˆå¾ˆå…³é”®ï¼‰

1ï¸âƒ£ **Top10 / Top20 åˆ†æƒé‡ç‰ˆæœ¬å¯¹æ¯”**
2ï¸âƒ£ å¼•å…¥ **æˆåˆ†è‚¡æ¶¨åœ / å¤§å•æˆäº¤çš„åŠ æƒå› å­**
3ï¸âƒ£ å…±æŒ¯ â†’ ETF å®é™…æ”¶ç›Šçš„ **å‘½ä¸­ç‡ç»Ÿè®¡**

---

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç›´æ¥å¸®ä½ åšå…¶ä¸­ä¹‹ä¸€ï¼š

* âœ… **å…±æŒ¯è¯„åˆ†å¯è§†åŒ–ï¼ˆECharts å åŠ æ–¹æ¡ˆï¼‰**
* âœ… **588080 çš„å®ç›˜å›æµ‹é€»è¾‘ï¼ˆåˆ†é’Ÿçº§ï¼‰**
* âœ… **å…±æŒ¯å¤±è´¥æ ·æœ¬åˆ†æï¼ˆä¸ºä»€ä¹ˆä¼šå‡çªç ´ï¼‰**

ä½ æŒ‘ä¸€ä¸ª ğŸ‘‡
