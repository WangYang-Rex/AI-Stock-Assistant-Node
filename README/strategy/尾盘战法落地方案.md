这个问题问得**非常到位**，而且你这个技术栈（**React + NestJS**）
👉 **非常适合把这套“尾盘买入·次日卖出”战法做成一个“专业级功能模块”**，而不是散落的脚本。

我给你一个**产品级 + 工程级**的完整设计方案，你可以直接拆任务开干。

---

# 一、这个功能在产品里的正确形态

先说结论：

👉 **不要做成“自动交易”**
👉 要做成 **「尾盘战法信号模块 + 决策辅助」**

### 在你软件里的定位可以叫：

* `尾盘机会扫描`
* `隔夜策略信号`
* `T+1 情绪延续模型`

---

# 二、整体系统架构（和你现有系统怎么融合）

```
┌────────────┐
│   React    │  ← 策略可视化 / 信号面板
└─────▲──────┘
      │ REST / WebSocket
┌─────┴──────┐
│   NestJS   │  ← 策略引擎 / 规则判断
├────────────┤
│ Strategy   │  ← 尾盘战法模块（核心）
│ Indicator  │  ← VWAP / 均线 / 情绪因子
│ Data       │  ← 行情 & 成分股
└─────▲──────┘
      │
┌─────┴──────┐
│   Market   │  ← 行情源（你已有）
└────────────┘
```

---

# 三、后端（NestJS）设计 —— 这是核心

## 1️⃣ 建一个「策略模块」

```bash
src/modules/strategies/
  ├─ close-auction/
  │   ├─ close-auction.strategy.ts
  │   ├─ close-auction.service.ts
  │   ├─ close-auction.controller.ts
  │   └─ dto/
```

---

## 2️⃣ 策略输入（标准化）

```ts
// close-auction.input.ts
export interface CloseAuctionInput {
  symbol: string;        // 588080
  date: string;          // 交易日
  minuteBars: MinuteK[]; // 5分钟K
  dailyBar: DailyK;      // 日线
  components?: ComponentSnapshot[];
}
```

---

## 3️⃣ 核心策略逻辑（示例）

```ts
// close-auction.strategy.ts
export function evaluateCloseAuction(
  input: CloseAuctionInput,
) {
  const { minuteBars, dailyBar, components } = input;

  const vwap = calcVWAP(minuteBars);
  const lastPrice = minuteBars.at(-1).close;

  // ① 尾盘时间过滤
  if (!isBetween(lastBarTime(minuteBars), '14:40', '14:55')) {
    return { allow: false, reason: '非尾盘窗口' };
  }

  // ② 价格位置
  if (lastPrice < vwap) {
    return { allow: false, reason: '跌破VWAP' };
  }

  // ③ 成交量结构
  if (isDistribution(minuteBars)) {
    return { allow: false, reason: '疑似尾盘出货' };
  }

  // ④ 成分股共振
  if (!componentConfirm(components)) {
    return { allow: false, reason: '成分股未共振' };
  }

  return {
    allow: true,
    confidence: scoreConfidence(input),
  };
}
```

---

## 4️⃣ 输出标准化信号

```ts
export interface StrategySignal {
  strategy: 'CLOSE_AUCTION_T1';
  symbol: string;
  time: string;
  allow: boolean;
  confidence: number; // 0–100
  reasons: string[];
}
```

---

## 5️⃣ 定时触发（关键）

### 两种方式：

#### A️⃣ 定时任务（推荐）

```ts
@Cron('*/30 14-15 * * 1-5')
handleCloseAuctionScan() {
  this.strategyService.scan('588080');
}
```

#### B️⃣ 行情驱动（进阶）

* 行情推送 → 判断是否进入 14:40
* 自动触发策略评估

---

# 四、前端（React）如何呈现（这是体验关键）

## 1️⃣ 功能入口

> 📊 **策略中心 → 尾盘战法**

---

## 2️⃣ 信号卡片设计（强烈建议）

```tsx
<StrategyCard
  title="尾盘隔夜机会"
  symbol="588080"
  status="ALLOW"
  confidence={78}
  reasons={[
    '价格站上VWAP',
    '尾盘缩量承接',
    '中芯国际同步走强'
  ]}
/>
```

### 展示重点：

* ✅ 是否允许买
* 🔥 信心分（不要直接给买卖）
* 🧠 原因（透明可解释）

---

## 3️⃣ 分时图叠加（专业感拉满）

在 5 分钟图上：

* VWAP 线
* 尾盘时间区间高亮
* 买入建议点（虚线）

---

# 五、回测模块（你未来一定会做）

## 1️⃣ 数据表建议

```sql
strategy_signals
- id
- strategy
- symbol
- date
- confidence
- allow
- next_day_return
```

---

## 2️⃣ 自动回填次日结果

```ts
// 次日 09:40
updateNextDayResult(signalId, {
  openReturn,
  highReturn,
});
```

---

## 3️⃣ 前端展示

* 最近 20 次信号
* 胜率
* 平均收益
* 最大回撤

---

# 六、你这个背景下的“最佳实现顺序”

### 第一阶段（2 天）

* 后端策略模块
* 固定只做 588080
* 手动触发

### 第二阶段（1 周）

* 定时扫描
* 前端信号卡
* 简单统计

### 第三阶段（进阶）

* 多 ETF
* 参数可配置
* 情绪因子引入

---

# 七、最重要的一句话（工程视角）

> **策略不是 if-else，而是“可解释 + 可统计 + 可迭代”的系统**

你这个系统 **已经 80% 在正确路上** 了。

---

## 下一步我可以直接帮你：

1️⃣ **把尾盘战法完整写成一个 NestJS Service（可直接复制）**
2️⃣ **设计 Strategy 表结构 + 回测数据流**
3️⃣ **React 端完整页面结构（含图表叠加）**

你选一个，我直接给你**可落地代码级方案**。
