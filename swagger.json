{
  "swagger": "2.0",
  "info": {
    "title": "AI股票助手 API",
    "description": "基于 NestJS 的 AI 股票助手后端服务接口文档。提供股票同步、行情快照、K线分析、交易记录管理及 AI 信号推送等功能。",
    "version": "1.1.0",
    "contact": {
      "name": "AI股票助手开发团队"
    }
  },
  "host": "localhost:3000",
  "basePath": "/",
  "schemes": ["http", "https"],
  "consumes": ["application/json"],
  "produces": ["application/json"],
  "tags": [
    { "name": "股票管理", "description": "股票基础信息同步与管理" },
    { "name": "行情数据", "description": "股票当日分时快照及排行榜" },
    { "name": "K线数据", "description": "历史 K 线数据同步与查询" },
    { "name": "分时数据", "description": "高频分时趋势数据" },
    { "name": "交易记录", "description": "用户交易买卖记录管理" },
    { "name": "AI信号", "description": "AI 模型生成的买卖建议信号" },
    { "name": "定时任务", "description": "系统自动化任务管理" },
    { "name": "健康检查", "description": "系统及数据库运行状态监控" },
    { "name": "应用", "description": "应用基础接口" }
  ],
  "paths": {
    "/": {
      "get": {
        "tags": ["应用"],
        "summary": "获取欢迎信息",
        "responses": {
          "200": { "description": "成功", "schema": { "type": "string" } }
        }
      }
    },
    "/health": {
      "get": {
        "tags": ["健康检查"],
        "summary": "健康检查",
        "description": "检查服务器及数据库连接状态",
        "responses": {
          "200": {
            "description": "状态正常",
            "schema": {
              "type": "object",
              "properties": {
                "status": { "type": "string", "example": "ok" },
                "database": { "type": "string", "example": "connected" },
                "timestamp": { "type": "string", "format": "date-time" }
              }
            }
          }
        }
      }
    },
    "/stocks/sync": {
      "post": {
        "tags": ["股票管理"],
        "summary": "同步股票信息",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "required": ["code", "market"],
              "properties": {
                "code": { "type": "string", "description": "股票代码" },
                "market": { "type": "integer", "description": "市场代码(1-上, 0-深)" }
              }
            }
          }
        ],
        "responses": {
          "200": { "description": "同步成功", "schema": { "$ref": "#/definitions/ApiResponse" } }
        }
      }
    },
    "/stocks/list": {
      "post": {
        "tags": ["股票管理"],
        "summary": "获取股票列表",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "market": { "type": "integer" },
                "marketType": { "type": "string", "enum": ["SH", "SZ"] }
              }
            }
          }
        ],
        "responses": {
          "200": { "description": "获取成功", "schema": { "$ref": "#/definitions/ApiResponse" } }
        }
      }
    },
    "/stocks/get-by-code": {
      "post": {
        "tags": ["股票管理"],
        "summary": "根据代码获取股票",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": { "code": { "type": "string" } }
            }
          }
        ],
        "responses": { "200": { "description": "成功", "schema": { "$ref": "#/definitions/ApiResponse" } } }
      }
    },
    "/quotes/syncStockQuotesFromAPI": {
      "post": {
        "tags": ["行情数据"],
        "summary": "从API同步行情快照",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "code": { "type": "string" },
                "market": { "type": "integer" }
              }
            }
          }
        ],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/quotes/latest": {
      "post": {
        "tags": ["行情数据"],
        "summary": "获取最新行情",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "schema": {
              "type": "object",
              "properties": { "code": { "type": "string" } }
            }
          }
        ],
        "responses": { "200": { "description": "成功", "schema": { "$ref": "#/definitions/Quote" } } }
      }
    },
    "/quotes/rankings-gainers": {
      "post": {
        "tags": ["行情数据"],
        "summary": "涨幅排行榜",
        "parameters": [
          { "name": "body", "in": "body", "schema": { "type": "object", "properties": { "limit": { "type": "integer", "default": 10 } } } }
        ],
        "responses": { "200": { "description": "成功", "schema": { "type": "array", "items": { "$ref": "#/definitions/Quote" } } } }
      }
    },
    "/kline/fetch": {
      "post": {
        "tags": ["K线数据"],
        "summary": "抓取并返回K线数据",
        "parameters": [
          { "name": "body", "in": "body", "schema": { "$ref": "#/definitions/FetchKlineOptions" } }
        ],
        "responses": { "200": { "description": "成功", "schema": { "type": "array", "items": { "$ref": "#/definitions/Kline" } } } }
      }
    },
    "/kline/sync": {
      "post": {
        "tags": ["K线数据"],
        "summary": "同步K线数据到数据库",
        "parameters": [
          { "name": "body", "in": "body", "schema": { "$ref": "#/definitions/FetchKlineOptions" } }
        ],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/trends/sync-from-api": {
      "post": {
        "tags": ["分时数据"],
        "summary": "同步分时趋势数据",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "code": { "type": "string" },
                "market": { "type": "integer" },
                "ndays": { "type": "integer", "enum": [1, 5], "default": 1 }
              }
            }
          }
        ],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/trading/create": {
      "post": {
        "tags": ["交易记录"],
        "summary": "创建交易记录",
        "parameters": [
          { "name": "body", "in": "body", "schema": { "$ref": "#/definitions/Trading" } }
        ],
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/trading/list": {
      "post": {
        "tags": ["交易记录"],
        "summary": "获取所有交易记录",
        "responses": { "200": { "description": "成功", "schema": { "type": "array", "items": { "$ref": "#/definitions/Trading" } } } }
      }
    },
    "/aisignals/get-latest": {
      "post": {
        "tags": ["AI信号"],
        "summary": "获取最新AI信号",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "schema": {
              "type": "object",
              "properties": {
                "symbol": { "type": "string" },
                "limit": { "type": "integer", "default": 20 }
              }
            }
          }
        ],
        "responses": { "200": { "description": "成功", "schema": { "type": "array", "items": { "$ref": "#/definitions/AiSignal" } } } }
      }
    },
    "/scheduler/status": {
      "get": {
        "tags": ["定时任务"],
        "summary": "获取定时任务状态",
        "responses": { "200": { "description": "成功" } }
      }
    },
    "/scheduler/trigger-sync": {
      "post": {
        "tags": ["定时任务"],
        "summary": "手动触发同步任务",
        "responses": { "200": { "description": "同步已触发" } }
      }
    }
  },
  "definitions": {
    "ApiResponse": {
      "type": "object",
      "properties": {
        "statusCode": { "type": "integer" },
        "message": { "type": "string" },
        "data": { "type": "object" },
        "timestamp": { "type": "string" }
      }
    },
    "Stock": {
      "type": "object",
      "properties": {
        "id": { "type": "integer" },
        "code": { "type": "string" },
        "name": { "type": "string" },
        "market": { "type": "integer" },
        "marketType": { "type": "string" },
        "price": { "type": "number" },
        "pct": { "type": "number" },
        "volume": { "type": "integer" },
        "totalMarketCap": { "type": "number" }
      }
    },
    "Quote": {
      "type": "object",
      "properties": {
        "id": { "type": "integer" },
        "code": { "type": "string" },
        "name": { "type": "string" },
        "price": { "type": "number" },
        "high": { "type": "number" },
        "low": { "type": "number" },
        "open": { "type": "number" },
        "preClose": { "type": "number" },
        "volume": { "type": "integer" },
        "updateTime": { "type": "integer", "description": "Unix时间戳" }
      }
    },
    "Kline": {
      "type": "object",
      "properties": {
        "id": { "type": "integer" },
        "code": { "type": "string" },
        "date": { "type": "string" },
        "open": { "type": "number" },
        "close": { "type": "number" },
        "high": { "type": "number" },
        "low": { "type": "number" },
        "volume": { "type": "integer" },
        "pct": { "type": "number" },
        "period": { "type": "integer" }
      }
    },
    "FetchKlineOptions": {
      "type": "object",
      "properties": {
        "code": { "type": "string" },
        "period": { "type": "string", "enum": ["daily", "weekly", "monthly", "1min", "5min", "15min", "30min", "60min"] },
        "fqType": { "type": "integer", "enum": [0, 1, 2], "description": "0-不复权, 1-前复权, 2-后复权" },
        "limit": { "type": "integer", "default": 100 },
        "startDate": { "type": "string", "example": "20240101" },
        "endDate": { "type": "string" }
      }
    },
    "Trading": {
      "type": "object",
      "properties": {
        "symbol": { "type": "string" },
        "name": { "type": "string" },
        "type": { "type": "string", "enum": ["buy", "sell"] },
        "price": { "type": "number" },
        "quantity": { "type": "integer" },
        "amount": { "type": "number" },
        "tradingTime": { "type": "string", "format": "date-time" }
      }
    },
    "AiSignal": {
      "type": "object",
      "properties": {
        "symbol": { "type": "string" },
        "signalType": { "type": "string", "enum": ["buy", "sell", "hold"] },
        "confidence": { "type": "integer", "description": "0-100" },
        "modelVersion": { "type": "string" },
        "signalTime": { "type": "string", "format": "date-time" }
      }
    }
  }
}
